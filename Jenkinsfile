pipeline {
    agent any
     environment {
        registry = "919795083283.dkr.ecr.ap-south-1.amazonaws.com/client-saas-server"
    }
    stages {
        
        stage('code pull from git') {
            steps{
                echo "current branch is ${BRANCH_NAME}"
              checkout([$class: 'GitSCM', branches: [[name: "*/${BRANCH_NAME}"]], extensions: [], userRemoteConfigs: [[credentialsId: 'ff55edc5-19a4-4b46-a0d3-9f5afd09ea04', url: 'https://git-codecommit.ap-southeast-1.amazonaws.com/v1/repos/clientspoc-sass-server']]])
            }
        }
        
        stage('Build docker') { 
            steps {
                script {
                    dockerImage = docker.build registry
                }
            }
        }
        stage('Push image to ECR') { 
            steps {

            // sh "aws ecr get-login-password --region ap-south-1 | docker login -u AWS -p eyJwYXlsb2FkIjoiU3VtZE54YXJiY1lMcE9UdzVqNHpNa2JGajVRdkFqMDBYa21nUjRxZWZQbFNHWnpMSEJXTGFYbHIvMldSRytKWjRidlBNT2FGOFd5Wk5BdzhhOVZNbVQwdFBHQlB5YzhKOWpvZ0l4YTZ3emQrdUl2Rjg4cmNwck11VnEyZHduK3dsVms0dTBoNHZRSHdXd1hiTUkxYlpwRzgrV0VCaUJydWNPblllSy9JMHFGczRybk9jY2dvSkkyb0hrVzNtQ2ZjdHJLNFpWQVZaYkZTM2NBTk1INzI0NDFybzk0V09qbXhkbHJtS2ZRZFNHbWE3QzA4NGZGM1BQRGMwOVhEbG1RUTB1MUVTdE9TNWJvUTE5aVg5ckpCcEVlL0p5N2p3Z1pYeXR3ZWl6L29pQThoK3RTTVNkaHdJZ04zUGFPZ1Fzem5YTG5ESGJDRzhkb3hMN21xM1Y5RkxzTnc2cXpKUFFXaUhaM2F6NStueWcvZmtmQThCNlB5aTJaSHlCWmRHMW4vWmZoOUZZbWdTWUlhU1BEa0paVm1ZZXM5M1c1blVVckNxdUpnQmFJR2pKM2E2SmdrRGVwL2xWV1lVS09oMis4UHU5R1NLbnRmdDUxQkhPeC8rd3lkNWdSdHA1L3d4WE4wTGw0SzNzWHFwY3ZNLzEwRW0yWmlaeVdSYTk1ZUZxZTB5NU5Fdk9RSGRrb1hjUjRZWnFGQjJEUG9EalIzeGt3UEZ2RkwzQXI1L3RoQ0ZGbUFvaE4wOW5GUGVBRGVzM0NnTGN4aWdOU2hPMHorN0lTOGRmbS83THV0MXFZL1VQMkRjQytZc25uSUFqZ0t1aWY0SDJ3MldIU0ZDWDBlWXplWjlWY2NvRVMxaytTcEpoNGdrR0huaXgycW92Y0gvbHk3SzRMREhCektlSmZ5ZzBYM1ZVMVBpZFpvMEU2UytXMXhoZlJUM1dac3JxREg0d0Y5Mk1CVTVUTjlMbGdoSUw2WXZNbGZEVDlCdjN4L0gxM0FPUDFkVk1pN1VLcFBIUjZlVWszekY0UTlaR3FVM2RyUG8zbGZrSTdnaWJWaU5RenpsbFNhNXBTK1lyVEtZS0JVanJHbW9lQTYxN1VDOUVucG9TbUs4UndESlZPb3V2L1lhbXJCOWhqWFVVYnZsNXhudmxPZHZmalhFM2VmZGRNdUZLYmRiNHR5R2R1anFKbFpraVliajZyY1ZBQXppRU5WTGdLUDZUaWdiZ3R2THJIZjE4TTRjbkp0V2IrUmdYQzlrekdDeVEzWjExWTdrYVp5QTQzR0RtRkFoV1RLeWx0ZzJtZGlkOUhUSW9GUHNKRXk1QzhsNVBDaythcTF3RFZra04zR2I0cWg1UHBVQmJpdk1CN2k0T2wvYTExaTUyaHVCK3BGeUkwPSIsImRhdGFrZXkiOiJBUUlCQUhpSFdhWVRuUlVXQ2Jueis3THZNRytBUHZUSHpIbEJVUTlGcUVtVjI2QmR3d0U3L09YZFFQMEdJNUxFOTh3VFcva0dBQUFBZmpCOEJna3Foa2lHOXcwQkJ3YWdiekJ0QWdFQU1HZ0dDU3FHU0liM0RRRUhBVEFlQmdsZ2hrZ0JaUU1FQVM0d0VRUU1WUEIweDdUTy9ITWJLa0dIQWdFUWdEdmpZcjZDSTU1R0FNTjVvT2gvYjdJSkZScFdBMlpjWGVyWnkreElVbGZrZVRtUkNqdGtSbjRCOXdDaDJBL25ic3VwK2VOTkRVTEl4Yy9nUHc9PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTYzNTUyNDE3Mn0= 919795083283.dkr.ecr.ap-south-1.amazonaws.com"
            // sh "aws ecr get-login-password --region ap-south-1 | docker login -u AWS -p eyJwYXlsb2FkIjoici9qRzlubTNBWWpDakVYc21zeXlSM1Z6RmdIc1I1NWtuT2p4NkVWMzJrT2NmVVVYMHlGalhrQ3lwdGZoWTRiRVE2OUw1cS9VLzZOSVFBNDYyL0lWMElCaXpidDZiTVJROU1nTGtGejZVK0hmNUFlcjZnR1FHMmlKN1dKbFlWMEQxVGhaNE1tWlFaeHY2OHRNcUFNWnhwQ2FLMy9WdUdTQ0ZFRDVCVXliWWtGZDdGeWNuaGpQZTFjMDJtbzhCK2JFMDJlOFZxVVhoSlplUVdNcW1jOTJ0M0FLcUhLVkpGaXlrTDB6aWQrOVRhR1lpdE56bkFqbVlxT1NDbU4rdzNIR2JKZ00xbkNMVG9TckNBeEk5NU5UUUJSbHR3NUtaYlNWbFhHNG81ejZCZWkxUU1RZXZEaFlTNG9uSE53NzNRVUZyT1pTZG83T21RQWRIMXE1MUl6ckhFQzl5cTlkU0RFZXQvQ2ZabndxTjBWbE1wNEZEbXJxV09SbTVQU1RVcXBSRG02UjRRMzRJaFFMUjBjNkFzbkpGWHRnZGNwTWRYelpRckRnbkd2aFlrVTJJL2o4MVpkUjc0QmpHdXlmNGY4SFRtakcwRXJ5YllmbWRRZ0lBRks0NXl5ZnVML2d1cXNGN3IyWFVyL3hPcGt3enFJNmRNalZWK3JnR2c3TkJhTUNja05rNWhWNlhDTUMxb2RNUW9RdWF2VlVYSGZnUmFGVUxoY1V4cktqUlQ4K1Zncm5EZzIwUUhpOTFGVGs0UXpaY2xLYTd6cFdhRVhRK1JTZXFrRVVDblZQOHVveTdHUlBlR3pBa1JRaGJEVlBjQ01YdjRYd1F2RnNFbmlWbVZvRmdWc2xRazZXd1gvZVFLU1RHVEZQNGNWM0lFQ2ZWUkhyeHlXMW9NRjNNNEpIT2d6TkF6SGdNaHlaWHYzdEtsWSs1Z05iNDIrbmc3and6MytDSTlvb2pVbWREMVB2ZkI2SVpaNTcrZStBVGYyaHZWSktJZ2NadkhPRU80N2pvUGRWMHAvaXpjZ3Znc0t5Z2oybE4zQ1RwRDF4OEpFb2laYUo0U3l1aS9RMjlLVzlkamJISnZxeStSVGtWdlBxV3dvZGtDakN6eUZiN1VUdnBUSlRLU0pNRUxRZ1l6ZlhPT0RpZGZwbVd0d21uSmd2NWhJZEx3bG1PYXY0UEI4SVExY2s0eGdxc3Q1akR2cmZxdE01SHJNNFlHRWk4eEpoYnE1VS9YVFFoWTMvL3BQVWlPaW5aRmIzamJVUlUxaGEzYkg4d2h1cGhSa2p6WmROOXFBQ3B5WmJ4a3o4UFlVN3YrRldnMXFMOGZOdE44emZSKzdoakJUaWpEc3dBcjNQU1I0NFRuRzBsMnk0cHJrTFpDZWxwQ21SUFhFPSIsImRhdGFrZXkiOiJBUUlCQUhpSFdhWVRuUlVXQ2Jueis3THZNRytBUHZUSHpIbEJVUTlGcUVtVjI2QmR3d0Z1aVBqTS9mUkwwTkE0cC9NOWMvaGNBQUFBZmpCOEJna3Foa2lHOXcwQkJ3YWdiekJ0QWdFQU1HZ0dDU3FHU0liM0RRRUhBVEFlQmdsZ2hrZ0JaUU1FQVM0d0VRUU1WUUdwQWt5NDhmNHhGb0FnQWdFUWdEdkJ1cVZreHk5UTI5d3EvTm9Zbng5aHo5ZllIektiL2d2aWx4a0s0am5CdjNmc3hYL0FUQVBJek5pUjEvak1lMzRCQXdZeTlHenR2TkRyZEE9PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTYzNTc3OTg5M30= 919795083283.dkr.ecr.ap-south-1.amazonaws.com" 
            //sh "aws ecr get-login-password --region ap-south-1 | docker login -u AWS -p  eyJwYXlsb2FkIjoiMzBTTTV6QW1iUWhITWZWMXNKenIxNlJEYkNTQjg5SElFc0hmQWdjWUdtdnZQUUtQRnVHTVpqUC9BWmpIWWZWbGRJNnNLK1NzMXoxMFVlaDhnUDVPU2ZJejFDcDgwWkMyQXo2eGhGVFdBaHowZ0tpZk9hbVlEVzdjaFVVMjlaNFNualZvZWc1S0Z0N1dOVG9OTVYwUUtvRnVaRHVLTm9WTWw2cVY4akZORWFYUFRWb2ZQQ29tdXc3elcwNitlOFdQekNpbkZvejQwbnR3SkdPemczSit4VGt0MTVQVjFSeW9VdHVGbVowUVE0eXQ1QnEzUVorNGFKaUIydDZMZFZTNnFERjJ0a2I0R1AzSkZTb2xqZ1orYVJqMFRpMFZQSGdUc0RuVC8vdkFWVC9ZL3JONHNXTGNmaHBYVFdSamRDTVRzTzh3RDVTdVdGVlpSQm9qZEtrRjE2R25Lb3ZJa0xOZEVuNldtOVd6OVI2cTRVZnNzMk1nRmlKdnRkVjdWWk1oajR4QTBpcC90VEplMG84M2ZURHNiMm54bjNqQXR0STU5czROb0xNN3dWVVNBSVBTNElmUUZiQ3FlamNUdmpkb0VCb2M1OUZwUmhNUkZlYVVwd2p0a1BzQUNnVmlFUFNVbGJtZTRNQ29ORkVKc21kYlN2SkV6cDBzcjZSRi9xdm5tOFhDL0Focm96dzhMSnFFakd3OXdiQ05YaTFoaHBWMUdhN0dhdWx2NU5QMzJJK2dQYUVJTHhvV2dEZTlaRnA1ZjQveGFMWXNOMGFqdmlYNUJ1eGhjeXVNTnpzUzZ0c3h4VDVpU2dHT0J6Qk5oRUFlRWx0YUtOR2Y0dmR3R0FPMlJMWTdHZURGVC9ZMFV0bWR4NGRHVnBuUFdEMGdiY05IbUpvbHFwYmNZVFdpWFNkSTJFeUlyOTdWQnJpNzVyRkxYeU5Wbnp0MmlUNHkyVW5WakZJTXNwQmhaRnVCQi8zMTVVZWtrZ1Z6azJLNVhXRkZsTng1SlQ0SitScTY0L0s0UU9GaCttVTEwTE9YQ05FK0V5ajljcjROVlZLVkJxalFUOTBnL3lOREkwY2pud05qVkFrUGNaTlhPdC9RYkkxNXdaTXZmZUkxU09FSHlmejlaRzBzSTM4MW85ZVUweTFMbk42NTFZSnkzZG8xNXI2ZWg0UjhOU3dmL3VEVzQ5VktsMXpad3kyOVdKd1d5YTM0NnpjdlJ6eStNTWQ5c3AvSVZ3UlVDWVhrUWNkWHJaR3MvWXBvNDMwSzh4azYyeDdyd29hYlM1RmxQSkk1UWkwTTZweGdvSUU2aWZ4b0Zhck0zbm0xZFVnRmhYYThNUnN3bUlWZ0dBYVJPRE1lNjlzczM0ekhQeElFZW9ISWxOalc4N2NpczlUa3pUYm1yaGdnYld1QURmMD0iLCJkYXRha2V5IjoiQVFJQkFIaUhXYVlUblJVV0NibnorN0x2TUcrQVB2VEh6SGxCVVE5RnFFbVYyNkJkd3dHMUduMjhCaVlVUklEVUF5anBQQlAwQUFBQWZqQjhCZ2txaGtpRzl3MEJCd2FnYnpCdEFnRUFNR2dHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNSTFUTGRJVElWV3YyaDE2RkFnRVFnRHVsbXVRRnlvaWVIRlY5KzhncUdsYUFjOFpXUEVYNTVRRHRTcmlKNEt5bTFLeXJ2dmVGSGZ4QnQ5d2IwblNXVlN6dDBGc1laRnlnd3RlSVhRPT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE2MzU4NzA1MTR9 919795083283.dkr.ecr.ap-south-1.amazonaws.com"
            //sh "aws ecr get-login-password --region ap-south-1 | docker login -u AWS -p  eyJwYXlsb2FkIjoiWEs2NXl5S2lKUG5lbGc3TWYvNVliZEVndllkUXc5R1YyZmo3YjJicDY0ZlFiYk5UaHlpemEvb1NacGNXZE1XY0pyZTY2Y3NHbTRzTTNsOXBUVFYwK1RkdDdleDJTOHBjRUZIem1CZ3gwaVEwTWZVMSt4OFdyZnNwN3VYTjdKRTBzWlRKVU85UUZaNEhFVy9KZzZHN3FIN09adFgvWkdYWGludGFxQlJtQTg2UDIyVE9lYzBOTXpXdU1kUmdMdFE0QnR5TzRkaXNnZzJMeG85WVVVc1hBN2J3YkdBbmJvTmJjQWRmNE9iOWJUeUwrMFlpblIzT3c0d1NrTTYzWGlBWUtzbHlNR2FBenMwM3ZNd3pCN2x0TTlHRG85dVcxRVZRMTU4TzE1NGNSeUJiZ2ZGZU9GQVVvNzNURXptTjZsbVp1bDB1MkJGOGx3YkdwTzZUTVk2SUdUVXpDdVg5dVg4VEQ1RXhSVWhMSzgvOUp5VWZjVHJzbzc2MEUzQ2NjWnRIcU1IbHFoN3FPVU56K3A0TXU2Rk85SkdoanAxaTNEdEttclJranRRZ1JjSmlFWjVzbCtBTitQUUhiZEQ3NDBVSEw5SUwvSEtBTTd4N1BGYzZ2a1NxNnJyVHJZYmdMTW1yeUROc2ZvMzFWbmxjTXBFak9xdXJGYjBieU1sRmJSbWtpaENVVUd2ajhKTVdYRTJVOW91RjVMcHcwQnhENm5LNkE3NVR6MU1oR1d3NERuTnpCSXBVRVNUSmh0QWQ4OWxBOGV6N2xvSGMyeURuTzF2NHRrclB6emtGYm9oalBubDJ1MkE1cTNGdDhSL2hUVXdORG8xbHZGU29pa1p6eHNNdG5TSTJoeU5weDBWenQvMFcvV3hxRXM1aWc2dFh4c2w4eFBDNlJRTk0vZ0hXeHFHamdSaTdwU09tdTNtcVh0K3NwWDR5VWxpK0VEUXBpclN0ZjViTTJJZHVSckxPcW1XZjRUbHRpUTYvL2RZNFRITlZ4NmMwWUpnNE9saGc3WnUwWndjbGtWaGF5YUN4Qmtxb2FBQXdRbE5lWXlFeXZHZ2RhSDFiK1U5RnRhbjJYZnFvTjFsQTR5OEhJL0VmMm9HNzM2d3ovV0Q3cExsTzN5N2hreEVGdmVXdUpjZk9aZGUvZlBBcGl5NWJtRFR4RzJHZHhFamU5cFErd25RQ0w0Sko4Nnp3cjg5TUNFdDBDUWdYTFVGdzg1bnd5SzlQbFkzY09nTW8xcTAzbTU4dTRQM2g5VFIvWVpzZ1p5a3BsYkpWTnJDZlBIYVRwcXRibzVVQjhCQ28reGhxbXI5K254R0hIb1RHcGt6bHdEeFlxSXlwZEhhUDlDbVVmeTJmUjNLMGd0Y2hLOW1RVVgxREZJRUEvMTRsbzQ5NlRJVVJEUC9aa1lBZjFkVT0iLCJkYXRha2V5IjoiQVFJQkFIaUhXYVlUblJVV0NibnorN0x2TUcrQVB2VEh6SGxCVVE5RnFFbVYyNkJkd3dIZmN3MDltMm9uMkFwY1c3SEFHN0ptQUFBQWZqQjhCZ2txaGtpRzl3MEJCd2FnYnpCdEFnRUFNR2dHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNUlJ3U0l2aWlFU3NnWDJRT0FnRVFnRHVzYndXZXU3SU9kenluN25uK0xEWkhRTWtEb1JnM0t5RHlpOWVXVHVMVE1mRElTSmlJSDQwTFlXZWYvZngxaFY1VTVnWHZvRDlndVBEVS9RPT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE2MzU5NTY3ODZ9 919795083283.dkr.ecr.ap-south-1.amazonaws.com"
            // sh "aws ecr get-login-password --region ap-south-1 | docker login -u AWS -p  eyJwYXlsb2FkIjoiWGNWZlEwcUZHUktJRGNHN0Nhd0NDQndncFhUeHUxN044UTdZc0JNYitpMFkyMjk1ci9QUlFIVHpOc2FSSWlwZjRXOUpRU1A3Q29NcXZDWGFzU0hQL2FVeHhyU2lFbE11NjJGMjlaNG5DTG4rNHQyVDM4Y3lSUFMwbG5GSHNEalpPd0F6dXBJeFgzbGNJQklpM0h4K3d3dnYvVUJEc0VXUFMwdHl1ME5CUkhEUXM0K2llb0J0S3d6T0o4M3pFcDd6ZWlPZXVjVGhQeURVakdLM1lXZXZrcHFLWllFMm96NFZCK09ONHcyU2hvYmRQRW50WjlXcnYvcDZCRzArK2VIRmtTa2dza01BblAxQUduR1dDbEhlN3dnRm50NUtzb2FTYUF5UGdCemlxWklwU0V3YnRVVDVYTGpzb0tPZGdwUThWQkNaNWRsaTlsM1hJM2hOajUvWUdSNDV0ZUlyVWhEZkNwRDVvQVh0R3pjRDZZQ29zU0VZc3FjSTRXYktHZ0pHZStRMFhKeE8zdXNxSUIzYTdHUzh1QVJsallrdU1aOU12QjMxMWdXbDNqaTFwN3ZDMGptNXNaZU1jeDV2ZDNjU2pOMzdnL2JUQkZyRmJ3QmM2TDZIMHBUS3BWOE5Ra2F2RUxCeW4rSnVIdmNSZ3lZNDBBSTZPS09YMUdYY2dZSUlCRHgyZmJBaXU2UVd1RkVpc3JCb2U5MXlRakFaZ1AzM2E3ODdUOHFSMnZMZW1HSjZUMDIrVUlJVkluTVNlTVVycnZQMjdVMmh6WVBVSUt3aTlkblBWS3h6WWYrbDV5TjhUWWFnSjVWZUpIMDlYZGJBaWNjejBtM1Q0amVwaHkvRnVlaDM2OFIrelNEY2R1WEc5N040TDlPeDhaOXljSThvL1FKaXNsWU9DT3FEcWFzSmlmd2pZTW5OMkY5b2luQ3NrVmVJenh1VS9XRXlHZm9GM3g4QS9TZmpZd21vSkRNNEU1RWlMdzhDNmU3QVRZZittRkphVjI4SXc0Njc4Q0pUYi9IVlRMei9RbUliS1ZKckdRQTJQVHFOTkZONEgvdDU0N1VySjBBZlV5Mk1VK01zZjZQTVNkUEdKMUV2TThOMkw2c2EvTmh1ODFTd1VrRWFpbGR1Mzd6S0VqMENKYmVWakliUEMrM2dDNXBLUExKeFVESlI2cXc2M3lFdGJEeEEycHNPaWVZMnhIbHNxYnpNbzJDYSszTmZ3VlN0cWx5Y2JNU0lGL0twbDVrS2N5bi95bGM0WlpCQWRianlQQjZqcDdvTGY1VVkrT2ZlQ3dRcVV1cE1sWHRRdElxbHU0REV0Ymg3Y25McXZ4T0l6ZldNRkEyNC91VHkxcWFETldqM3JROTN3U2ZlU1hJUU1Ycno2L3F5QkgwPSIsImRhdGFrZXkiOiJBUUlCQUhpSFdhWVRuUlVXQ2Jueis3THZNRytBUHZUSHpIbEJVUTlGcUVtVjI2QmR3d0V1WjhLRnMwT05lQ1NsRXVnNENJQVNBQUFBZmpCOEJna3Foa2lHOXcwQkJ3YWdiekJ0QWdFQU1HZ0dDU3FHU0liM0RRRUhBVEFlQmdsZ2hrZ0JaUU1FQVM0d0VRUU1kSFhWV3VueGpJWWtEUWx2QWdFUWdEdmIxcnJDVFVVblRhaDhHaFhGSTR6dDYyZGs4UzhqYy9iVXliVitxSE1HQXQyM1kwajZDUVFTYkU4SXhPWlFQMEx6cFUwb0xaUVFiMUxVc0E9PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTYzNjM4NjEwN30= 919795083283.dkr.ecr.ap-south-1.amazonaws.com"
             
              sh "docker push 919795083283.dkr.ecr.ap-south-1.amazonaws.com/client-saas-server:latest"

            }
        }
        
        stage('deploy'){
            
            steps{                

                sshagent(['13.214.233.50']) {
                  sh 'ssh -o StrictHostKeyChecking=no ubuntu@13.214.233.50 ./client-saas-backend-dev.sh'
                                   
                }
            }
            
        }
        
        
        
    }
}